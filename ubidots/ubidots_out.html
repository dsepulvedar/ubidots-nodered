<script type="text/x-red" data-template-name="ubidots_out">
   <div class="form-row">
       <label for="node-input-tier">
         <i class="icon-flag"></i>
         <span data-i18n="ubidots.select_tier"></span>
     </label>
       <select id="node-input-tier">
         <option value="business">Ubidots</option>
         <option value="educational">Ubidots for Education</option>
     </select>
   </div>

   <div class="form-row">
       <label for="node-input-name">
         <i class="icon-tag"></i>
         <span data-i18n="ubidots.name"></span>
     </label>
       <input type="text" id="node-input-name" data-i18n="[placeholder]ubidots.name" />
   </div>

   <div class="form-row">
       <label for="node-input-token">
         <i class="icon-lock"></i>
         <span data-i18n="ubidots.token.label"></span>
     </label>
       <input type="text" id="node-input-token" data-i18n="[placeholder]ubidots.token.placeholder" />
   </div>

   <div class="form-row">
       <label for="node-input-device_label">
         <i class="icon-tag"></i>
         <span data-i18n="ubidots.device_label.label"></span>
     </label>
       <input type="text" id="node-input-device_label" data-i18n="[placeholder]ubidots.device_label.placeholder" />
   </div>
  <div class="form-row">
       <label for="node-input-tls_checkbox" data-i18n="ubidots.tls.label"></label>
       <input type="checkbox" checked id="node-input-tls_checkbox" style="display: inline-block; width: auto; vertical-align: top;"></label>
   </div>


   </div>
</script>

<script type="text/x-red" data-help-name="ubidots_out">
  <p>Receives a message and uses its values to make a request to the Ubidots API.</p>

  <p>
      Uses the <a href="https://github.com/mqttjs/MQTT.js" target="_blank">MQTT</a> to make the connection and publish the packet.
  </p>

  <p>
      The message can contain the following properties, all of them except the <i>payload</i> can also be configured in the node settings by double clicking it:<br />

      <ul>
          <li>
              <b>msg.token</b> (required) - The token of your account.
          </li>
          <li>
              <b>msg.device_label</b> (optional) - The name of the Device in which the packet will be published. If no Device exists with this label, it will be automatically created.
          </li>
          <li>
              <b>msg.payload</b> (optional) - The values to be published on the given Device. Each key is the label of the variable.
          </li>
      </ul>
  </p>

  <p>
      Refer to the <a href="https://ubidots.com/docs/api/mqtt.html" target="_blank">Ubidots documentation</a> for more information about the functionality of the MQTT broker.
  </p>
</script>

<script type="text/javascript">
  RED.nodes.registerType("ubidots_out", {
    category: "output",
    color: "#5996F7",
    defaults: {
      name: {
        value: ""
      },
      token: {
        value: ""
      },
      label_device: { value: "" },
      device_label: {
        value: ""
      },
      tier: {
        value: "business"
      },
      tls_checkbox: { value: true }
    },
    inputs: 1,
    outputs: 0,
    icon: "ubidots.png",

    label: function() {
      return this.name || this.to || "ubidots out";
    },
    labelStyle: function() {
      return this.name ? "node_label_italic" : "";
    },
    oneditprepare: function() {
      console.log("inside oneditprepare OUT");
      if ($("#node-input-tls_checkbox").is("checked")) {
        console.log("inside TLS checked");
      }
    },
    oneditsave: function() {
      console.log("Inside OUT edit Save");
    }
  });
</script>

<style>
  .form-row label {
    width: 25%;
  }

  .form-row select {
    width: 70%;
  }
</style>
